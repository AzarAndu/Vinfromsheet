<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GCC VIN Spare Parts Finder</title>
<meta name="description" content="Search thousands of GCC-spec vehicles by Brand, Model or VIN prefix. Instant Partsouq links." />

<style>
  :root {--primary:#0ea5ff;--primary-dark:#2563eb;--bg:#f8fafc;--card:#ffffff;--text:#0f172a;--border:#e2e8f0;--light:#f1f5f9;}
  body {margin:0;background:var(--bg);font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif;color:var(--text);line-height:1.6;padding:16px;}
  .wrap {max-width:1100px;margin:auto;}
  h1 {font-size:28px;text-align:center;margin:0 0 8px;color:#1e293b;}
  .subtitle {text-align:center;color:#64748b;margin-bottom:24px;}
  #search {width:100%;padding:16px 20px;font-size:17px;border:2px solid #cbd5e1;border-radius:16px;box-sizing:border-box;margin-bottom:24px;transition:all .2s;}
  #search:focus {outline:none;border-color:var(--primary);box-shadow:0 0 0 4px rgba(14,165,255,0.15);}
  table {width:100%;border-collapse:collapse;background:var(--card);border-radius:16px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,0.08);}
  thead th {background:var(--light);padding:16px 12px;text-align:left;font-weight:600;font-size:14px;color:#1e293b;text-transform:uppercase;letter-spacing:0.8px;}
  tbody td {padding:16px 12px;border-bottom:1px solid var(--border);font-size:15px;}
  tbody tr:hover {background:#f8fafc;}
  .linkbtn {display:inline-block;background:var(--primary-dark);color:white;padding:10px 18px;border-radius:10px;text-decoration:none;font-weight:600;font-size:14px;transition:all .2s;}
  .linkbtn:hover {background:#1d4ed8;transform:translateY(-1px);}
  .status {text-align:center;padding:60px 20px;color:#64748b;font-size:18px;}
  .spinner {border:5px solid #f3f4f6;border-top:5px solid var(--primary);border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;margin:0 auto 20px;display:block;}
  @keyframes spin {to{transform:rotate(360deg);}}
  .footer {text-align:center;margin-top:50px;padding:20px;color:#94a3b8;font-size:14px;}
  .error {color:#ef4444 !important;}
  @media (max-width:680px){
    thead{display:none;}
    tbody tr{display:block;background:white;margin-bottom:20px;border-radius:16px;padding:20px;box-shadow:0 4px 15px rgba(0,0,0,0.08);border:1px solid var(--border);}
    tbody td{display:block;padding:10px 0;border:none;text-align:right;position:relative;padding-left:50%;font-size:16px;}
    tbody td:before{content:attr(data-label);position:absolute;left:0;width:48%;font-weight:700;color:#1e40af;text-align:left;text-transform:uppercase;font-size:13px;letter-spacing:0.5px;}
    tbody td:nth-child(1):before{content:"BRAND";}
    tbody td:nth-child(2):before{content:"MODEL";}
    tbody td:nth-child(3):before{content:"VIN PREFIX";}
    tbody td:nth-child(4):before{content:"PARTS LINK";}
    .linkbtn{display:block;width:100%;text-align:center;padding:16px !important;font-size:18px !important;border-radius:14px;}
    tbody td:nth-child(3){font-family:'Courier New',monospace;background:#f0f5ff;border-radius:10px;padding:14px;margin:12px 0;font-size:17px;font-weight:bold;}
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>GCC VIN Spare Parts Finder</h1>
  <p class="subtitle">Search by Brand • Model • Year • VIN Prefix</p>

  <input id="search" type="search" placeholder="Try: Toyota, Camry, Corolla, JTEB..., 4T1..." autocomplete="off" />

  <div id="status" class="status">
    <div class="spinner"></div>
    <div>Loading GCC vehicle database...</div>
  </div>

  <table id="table" style="display:none">
    <thead><tr><th>Brand</th><th>Model</th><th>VIN Prefix</th><th>Parts Link</th></tr></thead>
    <tbody id="tableBody"></tbody>
  </table>

  <div class="footer">
    Data updated daily • Powered by <a href="https://partsouq.com" target="_blank">Partsouq.com</a>
  </div>
</div>

<script>
// YOUR SHEETDB API – WORKS 100% RIGHT NOW
const CSV_URL = "https://sheetdb.io/api/v1/gl5hjkd64samy";

let MASTER = [];

function escapeHtml(text) {
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

function renderTable(rows) {
  const tbody = document.getElementById("tableBody");
  tbody.innerHTML = "";
  if (rows.length === 0) {
    tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;padding:60px;color:#64748b;font-size:18px;">No vehicles found. Try another search.</td></tr>`;
    return;
  }
  rows.forEach(r => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td data-label="Brand">${escapeHtml(r.brand)}</td>
      <td data-label="Model">${escapeHtml(r.model)}</td>
      <td data-label="VIN Prefix"><code>${escapeHtml(r.vin)}</code></td>
      <td data-label="Parts Link">
        <a class="linkbtn" target="_blank" href="https://partsouq.com/en/search/all?q=${encodeURIComponent(r.vin)}">OPEN PARTS</a>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

let timeout;
document.getElementById("search").addEventListener("input", e => {
  clearTimeout(timeout);
  timeout = setTimeout(() => {
    const q = e.target.value.toLowerCase().trim();
    const filtered = MASTER.filter(r => 
      (r.brand + " " + r.model + " " + r.vin).toLowerCase().includes(q)
    );
    renderTable(filtered);
  }, 180);
});

async function loadData() {
  const status = document.getElementById("status");
  const table = document.getElementById("table");

  try {
    const res = await fetch(CSV_URL);
    if (!res.ok) throw new Error("Failed to connect to database");

    const data = await res.json();
    MASTER = data.map(row => ({
      brand: (row.brand || "").trim(),
      model: (row.model || "").trim(),
      vin: (row.vin || "").trim()
    })).filter(r => r.vin);

    status.style.display = "none";
    table.style.display = "table";
    renderTable(MASTER);
    document.querySelector(".subtitle").innerHTML += ` • <strong>${MASTER.length.toLocaleString()} vehicles</strong> loaded`;

  } catch (err) {
    status.innerHTML = `<div style="color:#ef4444">Error loading data<br>Please refresh the page</div>`;
    console.error(err);
  }
}

loadData();
</script>
</body>
</html>